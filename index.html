<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mnemonic Verses</title>
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f8f8f8;
      --card:#ffffff;
      --ink:#222;
      --muted:#6f6f6f;
      --line:#e9e9e9;
      --accent:#F9E400;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --shadow-hover:0 14px 40px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Roboto","Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,sans-serif;
      color:var(--ink);
      -webkit-font-smoothing:antialiased;

      /* Always center on all screens */
      min-height:100svh; /* mobile-friendly viewport units */
      display:grid;
      place-items:center;
      padding:24px;
      position:relative;
      overflow:auto; /* allow scroll if content exceeds viewport */
    }

    /* Subtle animated background that frames the card */
    body::before, body::after {
      content:"";
      position:absolute; inset:0; z-index:-1;
      background:
        radial-gradient(circle at 20% 20%, #f9e40033 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, #4caf5033 0%, transparent 50%);
      background-size:200% 200%;
      animation: drift 25s ease-in-out infinite;
    }
    @keyframes drift {
      0% { background-position: 0% 0%, 100% 100%; }
      50%{ background-position: 100% 0%, 0% 100%; }
      100%{ background-position: 0% 0%, 100% 100%; }
    }

    .wrap{
      width:min(900px, 100%);
      max-width: 900px;
      position:relative;
      z-index:1;
      margin:auto;
    }

    /* Card */
    .card{
      width: clamp(320px, 92vw, 900px);
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      padding:clamp(18px,4vw,28px);
      overflow:visible;
      backdrop-filter: blur(6px);
    }
    .card:hover{ box-shadow:var(--shadow-hover); border-color:#dedede; }

    /* Verse block */
    .verse{
      font-family:"Roboto Mono", monospace;
      white-space:pre-wrap;
      font-size:clamp(16px,2.2vw,22px);
      line-height:1.5;
      margin:0 0 14px 0;
      letter-spacing:.2px;
    }
    .source{
      color:var(--muted);
      font-size:12px;
      margin:6px 0 12px 0;
      word-break: break-word;
    }
    .source a{
      color:inherit;
      text-decoration: underline;
    }

    /* Tags */
    .tags{ display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 12px 0; }
    .tag{
      font-size:11px; line-height:1;
      padding:.45rem .6rem;
      border-radius:999px;
      border:1px solid #ddd;
      background:#fafafa; color:#333;
    }

    /* Collapsible description */
    details{
      border:1px solid var(--line);
      border-radius:12px;
      background:#fcfcfc;
      padding:8px 12px;
      transition: border-color .2s ease, background .2s ease;
    }
    details[open]{ background:#fffbe6; border-color:var(--accent); }
    summary{
      list-style:none; cursor:pointer; font-weight:600; font-size:13px;
      display:flex; align-items:center; gap:8px; outline:none;
    }
    summary::-webkit-details-marker{display:none}
    .chev{ width:16px; height:16px; display:inline-block; transform:rotate(0deg); transition:transform .15s ease; }
    details[open] .chev{ transform:rotate(90deg); }
    .desc{ margin:8px 0 4px 0; color:#333; font-size:clamp(13px, 1.6vw, 14px); line-height:1.6; }

    /* Count */
    .meta{ display:flex; align-items:center; justify-content:flex-end; gap:10px; margin-top:14px; }
    .count{ font-size:12px; color:var(--muted); min-width:64px; text-align:right; }


    .copy-btn{
      font-size:12px; line-height:1;
      padding:.45rem .6rem;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff; cursor:pointer;
    }
    .copy-btn:active{ transform: translateY(1px); }  

    /* Outside arrows */
    .nav-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:48px; height:48px;
      border-radius:999px;
      background:rgba(255,255,255,0.6);
      display:flex; align-items:center; justify-content:center;
      backdrop-filter: blur(6px);
      box-shadow:0 2px 8px rgba(0,0,0,.1);
      cursor:pointer;
      z-index:2;
      border:1px solid var(--line);
      -webkit-tap-highlight-color: transparent;
    }
    .nav-btn svg{ width:20px; height:20px; }
    .nav-btn.left{ left:-64px; }
    .nav-btn.right{ right:-64px; }

    /* Keyboard hint */
    .kbd{ display:inline-flex; gap:6px; align-items:center; color:#777; font-size:12px; margin-top:10px; flex-wrap:wrap; }
    kbd{
      border:1px solid #d6d6d6; border-bottom-width:2px;
      border-radius:6px; padding:2px 6px; font-size:11px; background:#fff;
      font-family:"Roboto Mono", monospace;
    }
    
    /* Audio toggle button */
    #audio-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      cursor: pointer;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(6px);
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      color: #333;
    }
    #audio-toggle:hover {
      box-shadow: var(--shadow-hover);
      border-color: #dedede;
    }

    /* Song label (appears only while playing) */
    #song-label{
      position: fixed;
      top: 24px;
      right: 84px; /* sits left of the toggle */
      z-index: 999;
      padding: 6px 10px;
      font-size: 13px;
      color: var(--muted);
      background: rgba(255,255,255,0.6);
      border: 1px solid var(--line);
      border-radius: 999px;
      backdrop-filter: blur(6px);
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity .2s ease, transform .2s ease;
      pointer-events: none;
      white-space: nowrap;
    }
    #song-label.show{ opacity:1; transform: translateY(0); }

    /* Footer credit */
    .credit{
      position: fixed;
      right: 16px;
      bottom: 10px;
      font-size: 11px;
      color: var(--muted);
      z-index: 1000;
    }
    .credit a{
      color: inherit;
      text-decoration: underline;
    }

    /* Mobile / small screens */
    @media (max-width: 700px){
      .nav-btn.left{ left:-16px; }
      .nav-btn.right{ right:-16px; }
      #song-label{ right: 76px; top: 18px; }
      .card{ width: 96vw; }
    }

    /* Very small heights: keep nav buttons within view */
    @media (max-height: 520px){
      .nav-btn{ top:auto; bottom: -24px; transform:none; }
    }

    @media (prefers-reduced-motion: reduce){
      body::before, body::after{ animation:none; }
      .card, .chev{ transition:none; }
    }
  </style>
</head>
<body>
  <audio id="background-audio" autoplay loop>
    <source src="aphextwin.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <div class="wrap" role="application" aria-label="Mnemonic verses swiper">
    <article class="card" aria-live="polite">
      <div id="verse" class="verse"></div>
      <div id="source" class="source"></div>
      <div id="tags" class="tags" aria-label="Tags"></div>

      <details id="details">
        <summary><span class="chev">‚ñ∂</span><span>Explain it to me</span></summary>
        <div id="desc" class="desc"></div>
      </details>

      <div class="meta">
        <button id="copy-verse" class="copy-btn" type="button" title="Copy verse">Copy Verse</button>

        <div class="count" id="count"></div>
      </div>
      <div class="kbd" aria-hidden="true">
        <span>Navigate</span><kbd>‚Üê</kbd><kbd>‚Üí</kbd> ‚Ä¢ <span>Expand</span> <kbd>Enter</kbd>
      </div>
    </article>

    <div class="nav-btn left" title="Previous" role="button" aria-label="Previous">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path d="M15 18l-6-6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="nav-btn right" title="Next" role="button" aria-label="Next">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
  </div>

  <!-- Song name label (shown while playing) -->
  <div id="song-label" aria-live="polite" aria-hidden="true">Aphex Twin ‚Äî Stone in Focus</div>

  <!-- Audio toggle -->
  <button id="audio-toggle" title="Toggle Music" aria-label="Toggle Music">üéµ</button>

  <!-- Footer credit -->
  <div class="credit">
    Made by <a href="https://phanosha.com" target="_blank" rel="noopener">Phanos Ha</a>
  </div>

  <!-- App logic: load JSON from mnemonic.json -->
  <script type="module">
  const verseEl = document.getElementById('verse');
  const sourceEl = document.getElementById('source');
  const tagsEl = document.getElementById('tags');
  const descEl = document.getElementById('desc');
  const detailsEl = document.getElementById('details');
  const countEl = document.getElementById('count');
  const navLeft = document.querySelector('.nav-btn.left');
  const navRight = document.querySelector('.nav-btn.right');
  const copyBtn = document.getElementById('copy-verse');


  let DATA = [];
  let idx = 0;

  const normalizeNewlines = (text) =>
    String(text ?? "").replace(/\\n/g, "\n").replace(/\/n/g, "\n");

  function setSource(node, label, url){
    node.innerHTML = "";
    if (url){
      const a = document.createElement('a');
      a.href = url; a.target = "_blank"; a.rel = "noopener noreferrer";
      a.textContent = label ?? url;
      node.appendChild(a);
    } else {
      node.textContent = label ?? "";
    }
  }

  function render(i){
    if (!DATA.length) return;
    const item = DATA[i] ?? {};
    verseEl.textContent = normalizeNewlines(item.mnemonic_verse);
    setSource(sourceEl, item.source, item.source_url);
    descEl.textContent = item.description ?? "";
    tagsEl.innerHTML = (item.tags || []).map(t => `<span class="tag">${t}</span>`).join('');
    detailsEl.open = false;
    verseEl.focus?.({preventScroll:true});
    countEl.textContent = `${i+1} / ${DATA.length}`;
  }

  function next(){ idx = (idx+1) % DATA.length; render(idx); }
  function prev(){ idx = (idx-1+DATA.length) % DATA.length; render(idx); }
  navLeft.addEventListener('click', prev);
  navRight.addEventListener('click', next);
  window.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowRight'){ next(); }
    else if(e.key === 'ArrowLeft'){ prev(); }
    else if(e.key === 'Enter'){ detailsEl.open = !detailsEl.open; }
  });

  // swipe
  let startX=null,startY=null,startTime=0;
  window.addEventListener('touchstart', (e)=>{
    const t=e.changedTouches[0];
    startX=t.clientX; startY=t.clientY; startTime=Date.now();
  },{passive:true});
  window.addEventListener('touchend',(e)=>{
    const t=e.changedTouches[0];
    const dx=t.clientX-startX, dy=t.clientY-startY, dt=Date.now()-startTime;
    if(Math.abs(dx)>40 && Math.abs(dy)<80 && dt<600){ if(dx<0) next(); else prev(); }
  },{passive:true});

  // audio UI
  const audio = document.getElementById('background-audio');
  const audioToggle = document.getElementById('audio-toggle');
  const songLabel = document.getElementById('song-label');
  function updateAudioUI(){
    const isPlaying = !audio.paused && !audio.ended;
    audioToggle.textContent = isPlaying ? 'üîà' : 'üîá';
    songLabel.classList.toggle('show', isPlaying);
    songLabel.setAttribute('aria-hidden', isPlaying ? 'false' : 'true');
  }
  audio.volume = 0.3;
  audioToggle.addEventListener('click', () => {
    if (audio.paused || audio.ended) {
      audio.play().catch(()=>{});
    } else {
      audio.pause();
    }
    setTimeout(updateAudioUI, 0);
  });
  audio.addEventListener('play', updateAudioUI);
  audio.addEventListener('pause', updateAudioUI);
  audio.addEventListener('ended', updateAudioUI);
  window.addEventListener('load', updateAudioUI);

  copyBtn.addEventListener('click', async () => {
    try{
      await navigator.clipboard.writeText(verseEl.textContent || '');
      const prev = copyBtn.textContent;
      copyBtn.textContent = 'Copied';
      setTimeout(()=> copyBtn.textContent = prev, 900);
    }catch(e){
      const prev = copyBtn.textContent;
      copyBtn.textContent = 'Failed';
      setTimeout(()=> copyBtn.textContent = prev, 1200);
    }
  });


  // ---- robust loader for mnemonic.json ----
  async function loadData(){
    try {
      // IMPORTANT: use a relative path and strip BOM/whitespace before JSON.parse
      const res = await fetch(`./mnemonic.json?v=${Date.now()}`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);

      let text = await res.text();
      text = text.replace(/^\uFEFF/, '').trim(); // remove BOM + leading ws

      const parsed = JSON.parse(text);
      if (!Array.isArray(parsed)) throw new Error('JSON root is not an array');

      DATA = parsed;
      idx = 0;
      render(idx);
    } catch (err) {
      console.error('mnemonic.json load failed:', err);
      // visible hint in UI
      verseEl.textContent = "No data available.";
      sourceEl.innerHTML =
        `<span style="color:#999;font-size:12px">Load error: ${err.message}</span>`;
      descEl.textContent = "";
      countEl.textContent = "0 / 0";

      // minimal fallback so you can still test the UI
      DATA = [{
        mnemonic_verse: "Fallback item ‚Äî your mnemonic.json failed to load.",
        description: "Check DevTools ‚Üí Network for mnemonic.json status and make sure the JSON has no trailing commas.",
        source: "Local fallback",
        source_url: null,
        tags: ["debug"]
      }];
      idx = 0;
      render(idx);
    }
  }
  loadData();
</script>


</body>
</html>
